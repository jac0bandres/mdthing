(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();const m=window.markdownit({html:!1,linkify:!0,breaks:!0,highlight:function(n,t){if(t&&hljs.getLanguage(t))try{return'<pre class="hljs"><code>'+hljs.highlight(n,{language:t}).value+"</code></pre>"}catch{}return'<pre class="hljs"><code>'+m.utils.escapeHtml(n)+"</code></pre>"}}),r=document.getElementById("editor"),d=document.getElementById("preview");let f;const v=2e3;let a="",c="";const u=new Map;function p(n){const t=g(n);return m.render(t)}function L(){d.classList.remove("hidden"),d.classList.add("visible"),r.classList.remove("visible"),r.classList.add("hidden"),d.innerHTML=c}function g(n){return n.replace(/image=\[([^\]]*)\]/g,(t,e)=>u.has(e)?`![${e}](${u.get(e)})`:"")}function h(n){n.focus();const t=document.createRange(),e=window.getSelection();t.selectNodeContents(n),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}r.addEventListener("keydown",()=>{d.classList.remove("visible"),d.classList.add("hidden"),r.classList.remove("hidden"),r.classList.add("visible"),a=r.innerText,c=p(a),clearTimeout(f),f=setTimeout(L,v)});d.addEventListener("click",()=>{r.classList.remove("hidden"),r.classList.add("visible"),d.classList.remove("visible"),d.classList.add("hidden"),h(r)});function y(n){const t=window.getSelection(),e=t.getRangeAt(0);e.deleteContents();const s=document.createTextNode(n);e.insertNode(s),e.setStartAfter(s),e.setEndAfter(s),t.removeAllRanges(),t.addRange(e)}async function w(n){return new Promise(t=>{const e=new FileReader;e.onload=()=>t(e.result),e.readAsDataURL(n)})}const b=document.getElementById("export-md");function x(){const n=g(a),t=new Blob([n],{type:"text/markdown"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download="note.md",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e)}b.addEventListener("click",x);const E=document.getElementById("upload-md");E.addEventListener("change",n=>{const t=n.target.files[0];if(!t)return;const e=new FileReader;e.onload=function(s){a=s.target.result,r.innerText=a,c=p(a),d.innerHTML=c,d.classList.add("hidden"),d.classList.remove("visible"),r.classList.remove("hidden"),r.classList.add("visible")},e.readAsText(t)});r.addEventListener("dragover",n=>{n.preventDefault(),r.style.border="2px dashed #888"});r.addEventListener("dragleave",()=>{r.style.border="1px solid #444"});r.addEventListener("drop",async n=>{n.preventDefault(),r.style.border="1px solid #444";const t=n.dataTransfer.files;for(let e of t)if(e.type.startsWith("image/")){const s=await w(e);u.set(e.name,s),y(`image=[${e.name}]`)}});
